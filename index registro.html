<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Encuestas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
        }

        .polls-container {
            margin-bottom: 40px;
        }

        .candidate-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .candidate-info {
            display: flex;
            flex-direction: column;
            width: 150px;
        }

        .candidate-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ddd;
        }

        .bars-container {
            flex-grow: 1;
            height: 30px;
            display: flex;
            background: #f0f0f0;
        }

        .bar {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .bar-aprobado { background-color: #2196F3; } /* Azul */
        .bar-desaprobado { background-color: #f44336; } /* Rojo */
        .bar-no-sabe { background-color: #FF9800; } /* Amarillo/Naranja */

        .dates-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .dates-table th {
            background-color: #f5f5f5;
            padding: 10px;
            text-align: left;
        }

        .dates-table td {
            padding: 10px;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .dates-table tr:hover {
            background-color: #f0f0f0;
        }

    </style>
</head>
<body>
        
       <h1 style="text-align: center;">REGISTRO DE EVALUACIÓN DE GESTIÓN</h1>
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #2196F3;"></div>
            <span>Aprueba</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #f44336;"></div>
            <span>Desaprueba</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #FF9800;"></div>
            <span>No sabe/No opina</span>
        </div>
    </div>

    <div id="pollsContainer" class="polls-container">
        <!-- Las barras se generarán dinámicamente -->
    </div>

    <table class="dates-table">
        <thead>
            <tr>
                <th>FECHA</th>
               
            </tr>
        </thead>
        <tbody id="datesTableBody">
            <!-- Las fechas se generarán dinámicamente -->
        </tbody>
    </table>

    <script>
        // Obtener encuestas desde localStorage
        function getSurveysFromStorage() {
            return JSON.parse(localStorage.getItem('surveys')) || {};
        }

        // Actualizar la vista con los datos de la encuesta seleccionada
        function updatePollsDisplay(date) {
            const surveys = getSurveysFromStorage();
            const container = document.getElementById('pollsContainer');
            container.innerHTML = '';

            if (!surveys[date]) return;

            const survey = surveys[date];
            for (const candidate of survey.candidates) {
                const row = document.createElement('div');
                row.className = 'candidate-row';

                const candidateInfo = document.createElement('div');
                candidateInfo.className = 'candidate-info';

                const img = document.createElement('img');
                img.className = 'candidate-img';
                img.src = candidate.img || ''; // Asignar la imagen si existe
                
                const name = document.createElement('span');
                name.textContent = candidate.name;

                const region = document.createElement('span');
                region.textContent = candidate.region; // Solo imprimir el nombre de la región sin "Región:"

                candidateInfo.appendChild(img);
                candidateInfo.appendChild(name);
                candidateInfo.appendChild(region);  // Solo la región, sin la palabra "Región"
                row.appendChild(candidateInfo);

                const barsContainer = document.createElement('div');
                barsContainer.className = 'bars-container';

                const categories = ['aprobado', 'desaprobado', 'noSabe'];
                const colors = ['aprobado', 'desaprobado', 'no-sabe'];
                categories.forEach((category, index) => {
                    const value = candidate.percentages[category];
                    if (value > 0) {
                        const bar = document.createElement('div');
                        bar.className = `bar bar-${colors[index]}`;
                        bar.style.width = `${value}%`;
                        bar.textContent = `${value}%`;
                        barsContainer.appendChild(bar);
                    }
                });

                row.appendChild(barsContainer);
                container.appendChild(row);
            }
        }

        // Cargar la tabla de fechas
        function loadDatesTable() {
            const datesTableBody = document.getElementById('datesTableBody');
            const surveys = getSurveysFromStorage();

            Object.keys(surveys).forEach(date => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${date}</td><td></td>`;
                row.addEventListener('click', () => updatePollsDisplay(date));
                datesTableBody.appendChild(row);
            });
        }

        // Inicializar
        window.onload = () => {
            loadDatesTable();
            const surveys = getSurveysFromStorage();
            const firstDate = Object.keys(surveys)[0];
            if (firstDate) {
                updatePollsDisplay(firstDate);
            }
        };
    </script>
</body>
</html>
